<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CiteRight - Student Essay & Citation Helper</title>
    <style>
        /* ===== CSS VARIABLES FOR THEMING ===== */
        :root {
            --bg-primary: #f9f5f0;
            --bg-secondary: #fff8f0;
            --bg-card: #ffffff;
            --text-primary: #4a3828;
            --text-secondary: #6b5744;
            --accent-coffee: #a67c52;
            --accent-cream: #d4a574;
            --border-color: #e8ddd0;
            --shadow: rgba(166, 124, 82, 0.1);
            
            /* Highlight colors for essay analysis */
            --highlight-good: #d4f4dd;
            --highlight-warning: #fff4cc;
            --highlight-error: #ffd4d4;
            --highlight-info: #ffe8cc;
        }

        /* Dark theme */
        [data-theme="dark"] {
            --bg-primary: #2c1810;
            --bg-secondary: #3d2415;
            --bg-card: #4a2f1f;
            --text-primary: #f5e6d3;
            --text-secondary: #d4c4b0;
            --accent-coffee: #d4a574;
            --accent-cream: #a67c52;
            --border-color: #5c3d2e;
            --shadow: rgba(0, 0, 0, 0.3);
            
            --highlight-good: #2d4a2d;
            --highlight-warning: #4a4a2d;
            --highlight-error: #4a2d2d;
            --highlight-info: #4a3d2d;
        }

        /* ===== GLOBAL STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        /* ===== HEADER ===== */
        header {
            background-color: var(--accent-coffee);
            color: white;
            padding: 1.5rem;
            box-shadow: 0 2px 10px var(--shadow);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            font-size: 2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo-icon {
            font-size: 1.8rem;
        }

        /* Theme toggle button */
        .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* ===== NAVIGATION TABS ===== */
        .nav-tabs {
            background-color: var(--bg-secondary);
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            padding: 1rem;
            box-shadow: 0 2px 5px var(--shadow);
        }

        .tab-btn {
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            color: var(--text-primary);
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            background: var(--accent-cream);
            color: white;
            border-color: var(--accent-cream);
        }

        .tab-btn.active {
            background: var(--accent-coffee);
            color: white;
            border-color: var(--accent-coffee);
        }

        /* ===== MAIN CONTAINER ===== */
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ===== CARDS ===== */
        .card {
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 15px var(--shadow);
        }

        .card h2 {
            color: var(--accent-coffee);
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .card h3 {
            color: var(--accent-cream);
            margin: 1.5rem 0 1rem;
            font-size: 1.2rem;
        }

        /* ===== FORM ELEMENTS ===== */
        textarea, input, select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            background: var(--bg-secondary);
            color: var(--text-primary);
            margin-bottom: 1rem;
            transition: border-color 0.3s;
        }

        textarea:focus, input:focus, select:focus {
            outline: none;
            border-color: var(--accent-coffee);
        }

        textarea {
            min-height: 200px;
            resize: vertical;
            line-height: 1.8;
        }

        /* ===== BUTTONS ===== */
        button {
            background: var(--accent-coffee);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        button:hover {
            background: var(--accent-cream);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px var(--shadow);
        }

        button:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--border-color);
        }

        .btn-danger {
            background: #c74444;
        }

        .btn-danger:hover {
            background: #a03636;
        }

        /* ===== STATS DISPLAY ===== */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .stat-box {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent-coffee);
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* ===== LEGEND ===== */
        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
            margin: 1rem 0;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            border: 2px solid var(--border-color);
        }

        .legend-color.good { background: var(--highlight-good); }
        .legend-color.warning { background: var(--highlight-warning); }
        .legend-color.error { background: var(--highlight-error); }
        .legend-color.info { background: var(--highlight-info); }

        /* ===== ESSAY DISPLAY WITH HIGHLIGHTS ===== */
        .essay-display {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            min-height: 200px;
            white-space: pre-wrap;
            line-height: 2;
            font-size: 1rem;
        }

        .highlight-good { background-color: var(--highlight-good); padding: 2px 4px; border-radius: 3px; }
        .highlight-warning { background-color: var(--highlight-warning); padding: 2px 4px; border-radius: 3px; }
        .highlight-error { background-color: var(--highlight-error); padding: 2px 4px; border-radius: 3px; }
        .highlight-info { background-color: var(--highlight-info); padding: 2px 4px; border-radius: 3px; }

        /* ===== SUGGESTIONS LIST ===== */
        .suggestions {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
        }

        .suggestions ul {
            list-style-position: inside;
            padding-left: 0.5rem;
        }

        .suggestions li {
            margin: 0.5rem 0;
            color: var(--text-secondary);
        }

        /* ===== CITATION OUTPUT ===== */
        .citation-output {
            background: var(--bg-secondary);
            border: 2px solid var(--accent-coffee);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* ===== REFERENCES LIST ===== */
        .reference-item {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: start;
            gap: 1rem;
        }

        .reference-text {
            flex: 1;
            font-family: 'Courier New', monospace;
            word-wrap: break-word;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        /* ===== ESSAY TEMPLATE ===== */
        .template-section {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .template-section h4 {
            color: var(--accent-coffee);
            margin-bottom: 0.5rem;
        }

        .template-section p {
            color: var(--text-secondary);
            font-style: italic;
            font-size: 0.9rem;
        }

        /* ===== TIPS MODAL ===== */
        .tips-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--accent-coffee);
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 4px 15px var(--shadow);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 2rem;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px var(--shadow);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .close-modal {
            background: none;
            font-size: 1.5rem;
            color: var(--text-secondary);
            padding: 0;
            width: 30px;
            height: 30px;
        }

        .tips-list {
            list-style-position: inside;
        }

        .tips-list li {
            margin: 1rem 0;
            color: var(--text-secondary);
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-tabs {
                flex-wrap: wrap;
            }

            .tab-btn {
                flex: 1;
                min-width: 120px;
            }

            .reference-item {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header>
        <div class="header-content">
            <h1><span class="logo-icon">ðŸ“š</span> CiteRight</h1>
            <button class="theme-toggle" onclick="toggleTheme()">Toggle Theme</button>
        </div>
    </header>

    <!-- NAVIGATION TABS -->
    <nav class="nav-tabs">
        <button class="tab-btn active" onclick="openTab('essay')">Essay Helper</button>
        <button class="tab-btn" onclick="openTab('citation')">Citation Generator</button>
        <button class="tab-btn" onclick="openTab('library')">References Library</button>
    </nav>

    <!-- MAIN CONTAINER -->
    <div class="container">
        <!-- TAB 1: ESSAY HELPER -->
        <div id="essay" class="tab-content active">
            <div class="card">
                <h2>Essay Helper</h2>
                
                <!-- Live word count -->
                <div class="stats" id="liveStats">
                    <div class="stat-box">
                        <div class="stat-number" id="liveWords">0</div>
                        <div class="stat-label">Words</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="liveChars">0</div>
                        <div class="stat-label">Characters</div>
                    </div>
                </div>

                <!-- Essay input -->
                <textarea id="essayInput" placeholder="Paste or type your essay here..."></textarea>
                
                <button onclick="analyzeEssay()">Analyze Essay</button>
                <button class="btn-secondary" onclick="loadTemplate()">Load Essay Template</button>
            </div>

            <!-- Analysis Results -->
            <div id="analysisResults" style="display: none;">
                <div class="card">
                    <h2>Analysis Results</h2>
                    
                    <!-- Statistics -->
                    <div class="stats">
                        <div class="stat-box">
                            <div class="stat-number" id="wordCount">0</div>
                            <div class="stat-label">Words</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" id="sentenceCount">0</div>
                            <div class="stat-label">Sentences</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" id="paragraphCount">0</div>
                            <div class="stat-label">Paragraphs</div>
                        </div>
                    </div>

                    <!-- Color-coded essay display -->
                    <h3>Highlighted Essay</h3>
                    <div class="essay-display" id="highlightedEssay"></div>

                    <!-- Legend -->
                    <h3>Legend</h3>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color good"></div>
                            <span>Good sentences (15-25 words)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color warning"></div>
                            <span>Short sentences (&lt;10 words)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color error"></div>
                            <span>Long sentences (&gt;30 words)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color info"></div>
                            <span>Short paragraphs (&lt;3 sentences)</span>
                        </div>
                    </div>

                    <!-- Suggestions -->
                    <h3>ðŸ’¡ Suggestions</h3>
                    <div class="suggestions">
                        <ul id="suggestionsList"></ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 2: CITATION GENERATOR -->
        <div id="citation" class="tab-content">
            <div class="card">
                <h2>ðŸ“– Citation Generator</h2>
                
                <label for="citationStyle">Citation Style:</label>
                <select id="citationStyle">
                    <option value="apa">APA 7th Edition</option>
                    <option value="mla">MLA 9th Edition</option>
                    <option value="chicago">Chicago 17th Edition</option>
                </select>

                <label for="author">Author(s):</label>
                <input type="text" id="author" placeholder="e.g., Smith, J., & Doe, A.">

                <label for="title">Title:</label>
                <input type="text" id="title" placeholder="e.g., Understanding Citations">

                <label for="year">Year:</label>
                <input type="text" id="year" placeholder="e.g., 2024">

                <label for="publisher">Publisher:</label>
                <input type="text" id="publisher" placeholder="e.g., Academic Press">

                <label for="url">URL (optional):</label>
                <input type="text" id="url" placeholder="e.g., https://example.com">

                <button onclick="generateCitation()">Generate Citation</button>
            </div>

            <!-- Citation Output -->
            <div id="citationResult" style="display: none;">
                <div class="card">
                    <h2>Generated Citation</h2>
                    <div class="citation-output" id="citationOutput"></div>
                    <button onclick="copyCitation()">Copy to Clipboard</button>
                    <button class="btn-secondary" onclick="saveReference()">Save Reference</button>
                </div>
            </div>
        </div>

        <!-- TAB 3: REFERENCES LIBRARY -->
        <div id="library" class="tab-content">
            <div class="card">
                <h2>ðŸ“š References Library</h2>
                <p>All your saved citations in one place!</p>
                <button onclick="exportReferences()">Export All References</button>
                <button class="btn-danger" onclick="clearAllReferences()">Clear All</button>
            </div>

            <div id="referencesList"></div>
        </div>
    </div>

    <!-- WRITING TIPS BUTTON -->
    <button class="tips-btn" onclick="openTipsModal()">ðŸ’¡</button>

    <!-- TIPS MODAL -->
    <div class="modal" id="tipsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Writing Tips</h2>
                <button class="close-modal" onclick="closeTipsModal()">âœ•</button>
            </div>
            <ul class="tips-list">
                <li><strong>Avoid run-on sentences:</strong> Keep sentences between 15-25 words for clarity.</li>
                <li><strong>Vary sentence length:</strong> Mix short and long sentences for better flow.</li>
                <li><strong>Paragraph structure:</strong> Each paragraph should have at least 3-5 sentences.</li>
                <li><strong>Use topic sentences:</strong> Start each paragraph with a clear main idea.</li>
                <li><strong>Transition words:</strong> Use words like "however," "therefore," and "furthermore" to connect ideas.</li>
                <li><strong>Active voice:</strong> Write "The researcher conducted the study" instead of "The study was conducted."</li>
                <li><strong>Proofread:</strong> Always review your work before submitting.</li>
                <li><strong>Cite sources:</strong> Give credit to original authors to avoid plagiarism.</li>
            </ul>
        </div>
    </div>

    <script>
        // ===== THEME TOGGLE =====
        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        // Load saved theme on page load
        window.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
            loadReferences();
        });

        // ===== TAB NAVIGATION =====
        function openTab(tabName) {
            // Hide all tab contents
            const tabContents = document.getElementsByClassName('tab-content');
            for (let content of tabContents) {
                content.classList.remove('active');
            }

            // Remove active class from all buttons
            const tabButtons = document.getElementsByClassName('tab-btn');
            for (let btn of tabButtons) {
                btn.classList.remove('active');
            }

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // Reload references if library tab is opened
            if (tabName === 'library') {
                loadReferences();
            }
        }

        // ===== LIVE WORD/CHARACTER COUNT =====
        const essayInput = document.getElementById('essayInput');
        essayInput.addEventListener('input', updateLiveStats);

        function updateLiveStats() {
            const text = essayInput.value.trim();
            const words = text ? text.split(/\s+/).length : 0;
            const chars = text.length;

            document.getElementById('liveWords').textContent = words;
            document.getElementById('liveChars').textContent = chars;
        }

        // ===== ESSAY ANALYSIS =====
        function analyzeEssay() {
            const text = essayInput.value.trim();
            
            if (!text) {
                alert('Please enter some text to analyze!');
                return;
            }

            // Split into paragraphs (by double newlines or single newlines)
            const paragraphs = text.split(/\n\n+/).filter(p => p.trim());
            
            // Count words
            const words = text.split(/\s+/).length;
            
            // Split into sentences (basic split by .!?)
            const sentences = text.match(/[^.!?]+[.!?]+/g) || [];
            const sentenceCount = sentences.length;

            // Update statistics
            document.getElementById('wordCount').textContent = words;
            document.getElementById('sentenceCount').textContent = sentenceCount;
            document.getElementById('paragraphCount').textContent = paragraphs.length;

            // Analyze and highlight essay
            highlightEssay(text, paragraphs, sentences);

            // Generate suggestions
            generateSuggestions(paragraphs, sentences, text);

            // Show results
            document.getElementById('analysisResults').style.display = 'block';
            document.getElementById('analysisResults').scrollIntoView({ behavior: 'smooth' });
        }

        function highlightEssay(text, paragraphs, sentences) {
            let highlightedText = '';
            
            // Process each paragraph
            paragraphs.forEach((para, paraIndex) => {
                const paraTag = para.trim();
                // Get sentences in this paragraph
                const paraSentences = paraTag.match(/[^.!?]+[.!?]+/g) || [paraTag];
                
                // Check if paragraph is short (less than 3 sentences)
                const isShortParagraph = paraSentences.length < 3;
                
                paraSentences.forEach((sentence, sentIndex) => {
                    const wordCount = sentence.trim().split(/\s+/).length;
                    let highlightClass = '';
                    
                    // Determine highlight color based on word count
                    if (wordCount < 10) {
                        highlightClass = 'highlight-warning'; // Yellow - too short
                    } else if (wordCount > 30) {
                        highlightClass = 'highlight-error'; // Red - too long
                    } else if (wordCount >= 15 && wordCount <= 25) {
                        highlightClass = 'highlight-good'; // Green - perfect
                    }
                    
                    // Override with orange if paragraph is short
                    if (isShortParagraph) {
                        highlightClass = 'highlight-info'; // Orange - short paragraph
                    }
                    
                    // Add highlighted sentence
                    if (highlightClass) {
                        highlightedText += `<span class="${highlightClass}">${sentence}</span>`;
                    } else {
                        highlightedText += sentence;
                    }
                });
                
                // Add paragraph break
                highlightedText += '\n\n';
            });

            document.getElementById('highlightedEssay').innerHTML = highlightedText;
        }

        function generateSuggestions(paragraphs, sentences, text) {
            const suggestions = [];
            
            // Check for short paragraphs
            paragraphs.forEach((para, index) => {
                const paraSentences = para.match(/[^.!?]+[.!?]+/g) || [para];
                if (paraSentences.length < 3) {
                    suggestions.push(`Consider expanding paragraph ${index + 1} (it has only ${paraSentences.length} sentence${paraSentences.length === 1 ? '' : 's'}).`);
                }
            });

            // Check for very short sentences
            const shortSentences = sentences.filter(s => s.trim().split(/\s+/).length < 10).length;
            if (shortSentences > sentences.length * 0.3) {
                suggestions.push('You have many short sentences. Try combining related ideas for better flow.');
            }

            // Check for very long sentences
            const longSentences = sentences.filter(s => s.trim().split(/\s+/).length > 30).length;
            if (longSentences > 0) {
                suggestions.push(`You have ${longSentences} sentence${longSentences === 1 ? '' : 's'} that might be too long. Consider breaking them up.`);
            }

            // Check if essay has conclusion indicators
            const hasConclusion = /\b(in conclusion|to conclude|in summary|finally|therefore|thus)\b/i.test(text);
            if (!hasConclusion && paragraphs.length > 1) {
                suggestions.push('Consider adding a conclusion paragraph to summarize your main points.');
            }

            // Check if essay has introduction
            const hasIntro = paragraphs.length > 0 && paragraphs[0].split(/\s+/).length > 30;
            if (!hasIntro) {
                suggestions.push('Your introduction seems short. Ensure it clearly presents your topic.');
            }

            // Display suggestions
            const suggestionsList = document.getElementById('suggestionsList');
            if (suggestions.length === 0) {
                suggestionsList.innerHTML = '<li style="color: var(--accent-coffee);">Great job! Your essay structure looks good!</li>';
            } else {
                suggestionsList.innerHTML = suggestions.map(s => `<li>${s}</li>`).join('');
            }
        }

        // ===== ESSAY TEMPLATE =====
        function loadTemplate() {
            const template = `INTRODUCTION
[Start with a hook - an interesting fact, question, or statement]
[Provide background information on your topic]
[End with a clear thesis statement that presents your main argument]

BODY PARAGRAPH 1
[Topic sentence: Introduce your first main point]
[Supporting evidence: Provide facts, examples, or quotes]
[Explanation: Explain how this supports your thesis]
[Transition to next paragraph]

BODY PARAGRAPH 2
[Topic sentence: Introduce your second main point]
[Supporting evidence: Provide facts, examples, or quotes]
[Explanation: Explain how this supports your thesis]
[Transition to next paragraph]

BODY PARAGRAPH 3
[Topic sentence: Introduce your third main point]
[Supporting evidence: Provide facts, examples, or quotes]
[Explanation: Explain how this supports your thesis]
[Transition to conclusion]

CONCLUSION
[Restate your thesis in different words]
[Summarize your main points]
[End with a final thought or call to action]`;

            document.getElementById('essayInput').value = template;
            updateLiveStats();
            alert('Essay template loaded! Replace the bracketed text with your own content.');
        }

        // ===== CITATION GENERATOR =====
        let currentCitation = '';

        function generateCitation() {
            const style = document.getElementById('citationStyle').value;
            const author = document.getElementById('author').value.trim();
            const title = document.getElementById('title').value.trim();
            const year = document.getElementById('year').value.trim();
            const publisher = document.getElementById('publisher').value.trim();
            const url = document.getElementById('url').value.trim();

            // Validation
            if (!author || !title || !year) {
                alert('Please fill in at least Author, Title, and Year fields!');
                return;
            }

            let citation = '';

            // Generate citation based on style
            switch(style) {
                case 'apa':
                    citation = generateAPA(author, title, year, publisher, url);
                    break;
                case 'mla':
                    citation = generateMLA(author, title, year, publisher, url);
                    break;
                case 'chicago':
                    citation = generateChicago(author, title, year, publisher, url);
                    break;
            }

            // Display citation
            currentCitation = citation;
            document.getElementById('citationOutput').textContent = citation;
            document.getElementById('citationResult').style.display = 'block';
            document.getElementById('citationResult').scrollIntoView({ behavior: 'smooth' });
        }

        // APA 7th Edition format
        function generateAPA(author, title, year, publisher, url) {
            let citation = `${author} (${year}). ${title}.`;
            if (publisher) citation += ` ${publisher}.`;
            if (url) citation += ` ${url}`;
            return citation;
        }

        // MLA 9th Edition format
        function generateMLA(author, title, year, publisher, url) {
            let citation = `${author}. "${title}."`;
            if (publisher) citation += ` ${publisher},`;
            citation += ` ${year}.`;
            if (url) citation += ` ${url}.`;
            return citation;
        }

        // Chicago 17th Edition format
        function generateChicago(author, title, year, publisher, url) {
            let citation = `${author}. ${title}.`;
            if (publisher) citation += ` ${publisher},`;
            citation += ` ${year}.`;
            if (url) citation += ` ${url}.`;
            return citation;
        }

        // ===== COPY CITATION =====
        function copyCitation() {
            navigator.clipboard.writeText(currentCitation).then(() => {
                alert('Citation copied to clipboard!');
            }).catch(() => {
                alert('Failed to copy. Please copy manually.');
            });
        }

        // ===== SAVE REFERENCE =====
        function saveReference() {
            if (!currentCitation) {
                alert('Please generate a citation first!');
                return;
            }

            // Get existing references from memory or initialize empty array
            let references = JSON.parse(localStorage.getItem('references') || '[]');
            
            // Add new reference with timestamp
            references.push({
                citation: currentCitation,
                timestamp: new Date().toISOString(),
                style: document.getElementById('citationStyle').value.toUpperCase()
            });
            
            // Save to memory (NOT localStorage in production - see note below)
            localStorage.setItem('references', JSON.stringify(references));
            
            alert('Reference saved to your library!');
        }

        // ===== LOAD REFERENCES =====
        function loadReferences() {
            const referencesList = document.getElementById('referencesList');
            const references = JSON.parse(localStorage.getItem('references') || '[]');

            if (references.length === 0) {
                referencesList.innerHTML = '<div class="card empty-state">No saved references yet. Generate and save citations to see them here!</div>';
                return;
            }

            // Display references in reverse order (newest first)
            let html = '';
            references.reverse().forEach((ref, index) => {
                const actualIndex = references.length - 1 - index; // Get original index for deletion
                html += `
                    <div class="reference-item">
                        <div class="reference-text">
                            <strong style="color: var(--accent-coffee);">[${ref.style}]</strong><br>
                            ${ref.citation}
                        </div>
                        <button class="btn-danger" onclick="deleteReference(${actualIndex})">Delete</button>
                    </div>
                `;
            });

            referencesList.innerHTML = html;
        }

        // ===== DELETE REFERENCE =====
        function deleteReference(index) {
            if (!confirm('Are you sure you want to delete this reference?')) {
                return;
            }

            let references = JSON.parse(localStorage.getItem('references') || '[]');
            references.splice(index, 1);
            localStorage.setItem('references', JSON.stringify(references));
            loadReferences();
        }

        // ===== CLEAR ALL REFERENCES =====
        function clearAllReferences() {
            if (!confirm('Are you sure you want to delete ALL saved references? This cannot be undone!')) {
                return;
            }

            localStorage.removeItem('references');
            loadReferences();
            alert('All references have been cleared.');
        }

        // ===== EXPORT REFERENCES =====
        function exportReferences() {
            const references = JSON.parse(localStorage.getItem('references') || '[]');

            if (references.length === 0) {
                alert('No references to export!');
                return;
            }

            // Create text content
            let content = '=== CITERIGHT REFERENCES ===\n\n';
            references.forEach((ref, index) => {
                content += `${index + 1}. [${ref.style}]\n${ref.citation}\n\n`;
            });

            // Create downloadable file
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'citeright-references.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            alert('References exported successfully!');
        }

        // ===== TIPS MODAL =====
        function openTipsModal() {
            document.getElementById('tipsModal').classList.add('active');
        }

        function closeTipsModal() {
            document.getElementById('tipsModal').classList.remove('active');
        }

        // Close modal when clicking outside
        window.addEventListener('click', (e) => {
            const modal = document.getElementById('tipsModal');
            if (e.target === modal) {
                closeTipsModal();
            }
        });
    </script>
</body>
</html>
